<template>
  <lightning-card title={label.AW_WizardTitle} icon-name="standard:task2">
    <!-- Loading State -->
    <template lwc:if={isLoading}>
      <div class="slds-p-around_large slds-align_absolute-center">
        <lightning-spinner
          alternative-text={label.AW_Loading}
          size="medium"
        ></lightning-spinner>
      </div>
    </template>

    <!-- Error State -->
    <template lwc:elseif={hasError}>
      <div class="slds-p-around_medium">
        <div
          class="slds-notify slds-notify_alert slds-alert_error"
          role="alert"
        >
          <span class="slds-assistive-text">error</span>
          <h2>{label.AW_ErrorLoading}</h2>
        </div>
      </div>
    </template>

    <!-- Wizard Picker -->
    <template lwc:elseif={showPicker}>
      <div class="slds-p-around_medium">
        <p class="slds-text-body_regular slds-m-bottom_medium">
          {label.AW_SelectWizard}
        </p>

        <lightning-combobox
          label={label.AW_SelectWizard}
          options={availableWizards}
          onchange={handleWizardSelect}
          placeholder="-- Select --"
        ></lightning-combobox>

        <!-- In-Progress Sessions -->
        <template lwc:if={hasSessions}>
          <h3 class="slds-text-heading_small slds-m-top_large slds-m-bottom_small">
            {label.AW_InProgressSessions}
          </h3>
          <template for:each={sessionItems} for:item="session">
            <div
              key={session.sessionId}
              class="slds-box slds-m-bottom_x-small slds-theme_default"
            >
              <div class="slds-grid slds-grid_align-spread slds-grid_vertical-align-center">
                <div>
                  <p class="slds-text-body_regular slds-text-title_bold">
                    {session.displayName}
                  </p>
                  <p class="slds-text-body_small slds-text-color_weak">
                    {session.framework} &bull; {session.percentLabel}
                  </p>
                </div>
                <lightning-button
                  label="Resume"
                  variant="brand"
                  data-wizard={session.wizardName}
                  onclick={handleResumeSession}
                ></lightning-button>
              </div>
            </div>
          </template>
        </template>

        <template lwc:else>
          <p class="slds-text-body_small slds-text-color_weak slds-m-top_medium">
            {label.AW_NoSessions}
          </p>
        </template>
      </div>
    </template>

    <!-- Active Wizard -->
    <template lwc:elseif={hasConfig}>
      <div class="slds-p-around_medium">
        <!-- Progress Tracker -->
        <c-assessment-progress-tracker
          stages={wizardConfig.stages}
          current-stage={wizardConfig.currentStage}
          current-step={wizardConfig.currentStep}
          percent-complete={progressPercent}
        ></c-assessment-progress-tracker>

        <!-- Current Step -->
        <template lwc:if={currentStepConfig}>
          <c-wizard-step
            step={currentStepConfig}
            session-id={wizardConfig.sessionId}
            onstepcomplete={handleStepComplete}
          ></c-wizard-step>
        </template>

        <!-- Navigation -->
        <div class="slds-m-top_medium slds-grid slds-grid_align-spread">
          <lightning-button
            label={label.AW_PreviousStep}
            onclick={handlePrevious}
            disabled={isFirstStep}
          ></lightning-button>

          <template lwc:if={isLastStep}>
            <lightning-button
              label={label.AW_CompleteAssessment}
              variant="brand"
              onclick={handleComplete}
              disabled={isSaving}
            ></lightning-button>
          </template>
        </div>
      </div>
    </template>
  </lightning-card>
</template>
